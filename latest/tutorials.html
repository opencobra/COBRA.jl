<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorials · COBRA.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="index.html"><img class="logo" src="assets/logo.png" alt="COBRA.jl logo"/></a><h1>COBRA.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">COBRA.jl - COnstraint-Based Reconstruction and Analysis</a></li><li><a class="toctext" href="beginnerGuide.html">Beginner&#39;s Guide</a></li><li class="current"><a class="toctext" href="tutorials.html">Tutorials</a><ul class="internal"><li><a class="toctext" href="#Tutorial-COBRA.jl-1">Tutorial - COBRA.jl</a></li><li><a class="toctext" href="#Tutorial-distributedFBA.jl-1">Tutorial - distributedFBA.jl</a></li><li><a class="toctext" href="#Tutorial-PALM.jl-1">Tutorial - PALM.jl</a></li></ul></li><li><a class="toctext" href="configuration.html">Configuration</a></li><li><a class="toctext" href="functions.html">Modules and Functions</a></li><li><a class="toctext" href="faq.html">FAQ</a></li><li><a class="toctext" href="contents.html">Index</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href="tutorials.html">Tutorials</a></li></ul><a class="edit-page" href="https://github.com/github.com/opencobra/COBRA.jl.git/blob/master/docs/src/tutorials.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Tutorials</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Tutorials-1" href="#Tutorials-1">Tutorials</a></h1><h2><a class="nav-anchor" id="Tutorial-COBRA.jl-1" href="#Tutorial-COBRA.jl-1">Tutorial - COBRA.jl</a></h2><p>This tutorial serves as a quick start guide as well as an interactive reference for more advanced users. Download the live notebook from <a href="https://github.com/opencobra/COBRA.jl/tree/master/tutorials">here</a>.</p><h3><a class="nav-anchor" id="Installation-1" href="#Installation-1">Installation</a></h3><p>If you do not already have the <code>COBRA.jl</code> package installed, you must first first follow the installation instructions <a href="http://opencobra.github.io/COBRA.jl/">here</a>.</p><blockquote><p>Please note that should you run this tutorial on an already configured system. Otherwise, the following lines will throw an error message.</p></blockquote><p>Before running any function of <code>COBRA.jl</code>, it is necessary to include the <code>COBRA.jl</code> module:</p><pre><code class="language-julia">using COBRA</code></pre><p>You can test your system by running:</p><pre><code class="language-julia">COBRA.checkSysConfig()</code></pre><h3><a class="nav-anchor" id="Beginner&#39;s-Guide-1" href="#Beginner&#39;s-Guide-1">Beginner&#39;s Guide</a></h3><p>Should you not have any prior experience with Julia and/or Linux, please <strong>follow carefully</strong> the <a href="http://opencobra.github.io/COBRA.jl/stable/beginnerGuide.html">Beginner&#39;s Guide</a>. If you however feel that you are set to proceed with this tutorial, please consider the <a href="http://opencobra.github.io/COBRA.jl/stable/beginnerGuide.html">Beginner&#39;s Guide</a> as a go-to reference in case you are running into any issues. </p><p>If you see unusual behavior, you may consider reading the <a href="http://opencobra.github.io/COBRA.jl/stable/faq.html">FAQ section</a>.</p><h3><a class="nav-anchor" id="Quick-help-1" href="#Quick-help-1">Quick help</a></h3><p>Do you feel lost or you don’t know the meaning of certain input parameters? Try typing a question mark at the Julia REPL followed by a keyword. For instance:</p><pre><code class="language-julia">julia&gt; ? distributedFBA</code></pre><h3><a class="nav-anchor" id="Installation-check-and-package-testing-1" href="#Installation-check-and-package-testing-1">Installation check and package testing</a></h3><p>Make sure that you have a working installation of <code>MathProgBase.jl</code> and at least one of the supported solvers. You may find further information <a href="http://mathprogbasejl.readthedocs.io/en/latest/">here</a>. </p><p>If you want to install other solvers such as <code>CPLEX</code>, <code>CLP</code>, <code>Gurobi</code>, or <code>Mosek</code>, you can find more information <a href="https://github.com/JuliaOpt">here</a>.</p><p>You may, at any time, check the integrity of the <code>COBRA.jl</code> package by running:</p><pre><code class="language-Julia">julia&gt; Pkg.test(&quot;COBRA&quot;)</code></pre><p>The code has been benchmarked against the <code>fastFVA</code> implementation [<a href="#References-1">3</a>]. The modules and solvers are correctly installed when all tests pass without errors (warnings may appear).</p><h3><a class="nav-anchor" id="References-1" href="#References-1">References</a></h3><ol><li><p><a href="http://www.cambridge.org/us/academic/subjects/life-sciences/genomics-bioinformatics-and-systems-biology/systems-biology-constraint-based-reconstruction-and-analysis?format=HB">B. O. Palsson. Systems Biology: Constraint-based Reconstruction and Analysis. Cambridge University Press, NY, 2015.</a></p></li><li><p><a href="https://github.com/opencobra/cobratoolbox">Heirendt, L &amp; Arreckx, S. et al. Creation and analysis of biochemical constraint-based models: the COBRA Toolbox v3.0 (submitted), 2017.</a></p></li><li><p><a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-11-489">Steinn, G. et al. Computationally efficient flux variability analysis. BMC Bioinformatics, 11(1):1–3, 2010.</a></p></li><li><p><a href="http://gcrg.ucsd.edu/Downloads/EcoliCore">Orth, J. et al. Reconstruction and use of microbial metabolic networks: the core escherichia coli metabolic model as an educational guide. EcoSal Plus, 2010.</a></p></li></ol><h2><a class="nav-anchor" id="Tutorial-distributedFBA.jl-1" href="#Tutorial-distributedFBA.jl-1">Tutorial - distributedFBA.jl</a></h2><p>This tutorial serves as a reference to get started with <code>distributedFBA.jl</code>. Download the live notebook from <a href="https://github.com/opencobra/COBRA.jl/tree/master/tutorials">here</a>.</p><p>If you are not familiar with <code>COBRA.jl</code>, or how <code>COBRA.jl</code> should be installed, please refer to the tutorial on <code>COBRA.jl</code>.</p><pre><code class="language-julia">using COBRA</code></pre><h3><a class="nav-anchor" id="Adding-local-workers-1" href="#Adding-local-workers-1">Adding local workers</a></h3><p>The connection functions are given in <code>connect.jl</code>, which, if a parallel version is desired, must be included separately:</p><pre><code class="language-julia">include(&quot;$(Pkg.dir(&quot;COBRA&quot;))/src/connect.jl&quot;)</code></pre><p>You may add local workers as follows:</p><pre><code class="language-julia">## specify the total number of parallel workers
nWorkers = 4 

## create a parallel pool
workersPool, nWorkers = createPool(nWorkers) </code></pre><p>The IDs of the respective workers are given in <code>workersPool</code>, and the number of local workers is stored in <code>nWorkers</code>.</p><p>In order to be able to use the <code>COBRA</code> module on all connected workers, you must invoke:</p><pre><code class="language-julia">@everywhere using COBRA</code></pre><h3><a class="nav-anchor" id="Define-and-change-the-COBRA-solver-1" href="#Define-and-change-the-COBRA-solver-1">Define and change the COBRA solver</a></h3><p>Before the COBRA solver can be defined, the solver parameters and configuration must be loaded after having set the <code>solverName</code> (solver must be installed):</p><ul><li><p><code>:GLPKMathProgInterface</code></p></li><li><p><code>:CPLEX</code></p></li><li><p><code>:Clp</code></p></li><li><p><code>:Gurobi</code></p></li><li><p><code>:Mosek</code></p></li></ul><pre><code class="language-julia">## specify the solver name
solverName = :Gurobi #:GLPKMathProgInterface

## include the solver configuration file
include(&quot;$(Pkg.dir(&quot;COBRA&quot;))/config/solverCfg.jl&quot;)</code></pre><p>The name of the solver can be changed as follows:</p><pre><code class="language-julia">## change the COBRA solver
solver = changeCobraSolver(solverName, solParams)</code></pre><p>where <code>solParams</code> is an array with the definition of the solver parameters.</p><h3><a class="nav-anchor" id="Load-a-COBRA-model-1" href="#Load-a-COBRA-model-1">Load a COBRA model</a></h3><p>As a test and as an example, the <em>E.coli</em> core model may be loaded as:</p><pre><code class="language-julia">## download the test model
using Requests
include(&quot;$(Pkg.dir(&quot;COBRA&quot;))/test/getTestModel.jl&quot;)
getTestModel()</code></pre><p>Load the stoichiometric matrix S from a MATLAB <code>structure</code> named model in the specified .mat file</p><pre><code class="language-julia">model = loadModel(&quot;ecoli_core_model.mat&quot;, &quot;S&quot;, &quot;model&quot;);</code></pre><p>where <code>S</code> is the name of the field of the stoichiometric matrix and <code>model</code> is the name of the model. Note the semicolon that suppresses the ouput of <code>model</code>.</p><h3><a class="nav-anchor" id="Flux-Balance-Analysis-(FBA)-1" href="#Flux-Balance-Analysis-(FBA)-1">Flux Balance Analysis (FBA)</a></h3><p>In order to run a flux balance analysis (FBA), <code>distributedFBA</code> can be invoked with only 1 reaction and without an extra condition:</p><pre><code class="language-julia">## set the reaction list (only one reaction)
rxnsList = 13

## select the reaction optimization mode
##  0: only minimization
##  1: only maximization
##  2: maximization and minimization
rxnsOptMode = 1

## launch the distributedFBA process with only 1 reaction on 1 worker
minFlux, maxFlux  = distributedFBA(model, solver, nWorkers=1, rxnsList=rxnsList, rxnsOptMode=rxnsOptMode);</code></pre><p>where the reaction number <code>13</code> is solved. Note that the no extra conditions are added to the model (last function argument is <code>false</code>). The minimum flux and maximum flux can hence be listed as:</p><pre><code class="language-julia">maxFlux[rxnsList]</code></pre><h3><a class="nav-anchor" id="Flux-Variability-Analysis-(FVA)-1" href="#Flux-Variability-Analysis-(FVA)-1">Flux Variability Analysis (FVA)</a></h3><p>In order to run a common flux variability analysis (FVA), <code>distributedFBA</code> can be invoked with all reactions as follows:</p><pre><code class="language-julia">## launch the distributedFBA process with all reactions
minFlux, maxFlux, optSol, fbaSol, fvamin, fvamax = distributedFBA(model, solver, nWorkers=4, optPercentage=90.0, preFBA=true);</code></pre><p>The optimal solution of the original FBA problem can be retrieved with:</p><pre><code class="language-julia">optSol</code></pre><p>The corresponding solution vector <code>maxFlux</code> of the original FBA that is solved with:</p><pre><code class="language-julia">fbaSol</code></pre><p>The minimum and maximum fluxes of each reaction are in:</p><pre><code class="language-julia">maxFlux</code></pre><p>The flux vectors of all the reactions are stored in <code>fvamin</code> and <code>fvamax</code>.</p><pre><code class="language-julia">fvamin</code></pre><pre><code class="language-julia">fvamax</code></pre><h3><a class="nav-anchor" id="DistributedFBA-of-distinct-reactions-1" href="#DistributedFBA-of-distinct-reactions-1">DistributedFBA of distinct reactions</a></h3><p>You may now input several reactions with various <code>rxnsOptMode</code> values to run specific optimization problems.</p><pre><code class="language-julia">rxnsList = [1; 18; 10; 20:30; 90; 93; 95]
rxnsOptMode = [0; 1; 2; 2+zeros(Int, length(20:30)); 2; 1; 0]

## run only a few reactions with rxnsOptMode and rxnsList
## distributedFBA(model, solver, nWorkers, optPercentage, objective, rxnsList, strategy, preFBA, rxnsOptMode)
minFlux, maxFlux, optSol, fbaSol, fvamin, fvamax, statussolmin, statussolmax = distributedFBA(model, solver);</code></pre><p>Note that the reactions can be input as an unordered list.</p><h3><a class="nav-anchor" id="Saving-the-variables-1" href="#Saving-the-variables-1">Saving the variables</a></h3><p>You can save the output of <code>distributedFBA</code> by using:</p><pre><code class="language-julia">saveDistributedFBA(&quot;results.mat&quot;)</code></pre><p>Note that the results are saved in a <code>.mat</code> file that can be opened in MATLAB for further processing.</p><h3><a class="nav-anchor" id="Cleanup-1" href="#Cleanup-1">Cleanup</a></h3><p>In order to cleanup the files generated during this tutorial, you can remove the files using:</p><pre><code class="language-julia">rm(&quot;ecoli_core_model.mat&quot;)
rm(&quot;results.mat&quot;)</code></pre><h3><a class="nav-anchor" id="References-2" href="#References-2">References</a></h3><ol><li><p><a href="http://www.cambridge.org/us/academic/subjects/life-sciences/genomics-bioinformatics-and-systems-biology/systems-biology-constraint-based-reconstruction-and-analysis?format=HB">B. O. Palsson. Systems Biology: Constraint-based Reconstruction and Analysis. Cambridge University Press, NY, 2015.</a></p></li><li><p><a href="https://github.com/opencobra/cobratoolbox">Heirendt, L &amp; Arreckx, S. et al. Creation and analysis of biochemical constraint-based models: the COBRA Toolbox v3.0 (submitted), 2017.</a></p></li><li><p><a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-11-489">Steinn, G. et al. Computationally efficient flux variability analysis. BMC Bioinformatics, 11(1):1–3, 2010.</a></p></li><li><p><a href="http://gcrg.ucsd.edu/Downloads/EcoliCore">Orth, J. et al. Reconstruction and use of microbial metabolic networks: the core escherichia coli metabolic model as an educational guide. EcoSal Plus, 2010.</a></p></li></ol><h2><a class="nav-anchor" id="Tutorial-PALM.jl-1" href="#Tutorial-PALM.jl-1">Tutorial - PALM.jl</a></h2><p>This tutorial serves as a reference to get started with <code>PALM.jl</code>. Download the live notebook from <a href="https://github.com/opencobra/COBRA.jl/tree/master/tutorials">here</a>.</p><p>If you are not familiar with <code>COBRA.jl</code>, or how <code>COBRA.jl</code> should be installed, please refer to the tutorial on <code>COBRA.jl</code>.</p><p><strong>Note:</strong> In order to run this tutorial, you must have <a href="https://www.mathworks.com">MATLAB</a> installed and a valid MATLAB license.</p><p>Please make sure to have the following packages installed: <code>COBRA.jl</code>, <code>MATLAB</code>, and <code>MAT</code>.</p><pre><code class="language-julia">##=
Pkg.add(&quot;COBRA&quot;)
Pkg.add(&quot;MATLAB&quot;)
=#</code></pre><h3><a class="nav-anchor" id="Writing-a-MATLAB-script-1" href="#Writing-a-MATLAB-script-1">Writing a MATLAB script</a></h3><p>The main functionality of <code>PALM.jl</code> is to run a MATLAB script that loads a different model each time from a directory of models. The MATLAB script can be based on any tutorial of <a href="https://git.io/cobratoolbox">the CORBA Toolbox</a> or on a custom script.</p><p>In order to illustrate the inner workings of <code>PALM.jl</code>, we will write a custom script that loads a different model out of a folder of 4 models, and calculates several numerical characteristics of the stoichiometric matrix. The analysis is accelerated by distributing these 4 models across 2 different workers.</p><p>The MATLAB script can be saved as <code>scriptFile.m</code> in any folder. For illustration purposes, this script is located in the <code>test/</code> folder of the COBRA.jl installation directory, but may be located in any other directory. Its content can be visualized as follows:</p><pre><code class="language-julia">run(`cat $(Pkg.dir(&quot;COBRA&quot;))/test/scriptFile.m`)</code></pre><p>Note that the variables marked with <code>PALM_</code> are the ones defined within Julia.</p><h3><a class="nav-anchor" id="Installation-of-the-COBRA-Toolbox-1" href="#Installation-of-the-COBRA-Toolbox-1">Installation of the COBRA Toolbox</a></h3><p>As the <code>scriptFile.m</code> refers to the <code>readCbModel</code> function implemented in <a href="https://git.io/cobratoolbox">the COBRA Toolbox</a>, the COBRA Toolbox must be installed by following the installation instructions <a href="https://opencobra.github.io/cobratoolbox/stable/installation.html">here</a>.</p><p>If you already have a working installation of the COBRA Toolbox, you may skip the following lines. The COBRA Toolbox may be installed in any directory - please write it down for later use in this tutorial.</p><p><strong>Advanced users</strong> may also want to install the COBRA Toolbox directly installed from Julia. You must have <code>git</code> (or <code>gitBash</code> on Windows) installed - see <a href="https://opencobra.github.io/cobratoolbox/stable/installation.html#system-requirements">requirements</a>.</p><p>For illustration purposes of this tutorial, the COBRA Toolbox will be installed in the <code>/tmp</code> directory. This may take a while, depending on the speed of your internet connection.</p><pre><code class="language-julia">installDir = &quot;/tmp/cobratoolbox&quot;</code></pre><pre><code class="language-julia">## if you already ran this tutorial once, you may also remove the previous installation directory with the following command:
## Note: The following command removes the directory specified above!
run(`rm -rf $installDir`)</code></pre><pre><code class="language-julia">run(`git clone --depth=1 --recurse-submodules https://github.com/opencobra/cobratoolbox.git $installDir`);
info(&quot;The COBRA Toolbox has been cloned successfully to the $installDir directory.&quot;)</code></pre><p><strong>Tip:</strong> When using <code>PALM.jl</code>, it is advised to add the <code>--recurse-submodules</code> flag. This will speed up the simultaneous initialisations on several workers.</p><h3><a class="nav-anchor" id="Connecting-workers-1" href="#Connecting-workers-1">Connecting workers</a></h3><p>Similarly to <code>distributedFBA.jl</code>, the workers may be added using <code>createPool</code>, given in the external function <code>connect.jl</code>, which must be included separately. Please note that also workers connected via SSH may be added to the pool of workers.</p><pre><code class="language-julia">include(&quot;$(Pkg.dir(&quot;COBRA&quot;))/src/connect.jl&quot;)</code></pre><pre><code class="language-julia">## specify the total number of parallel workers
nWorkers = 4 

## create a parallel pool
workersPool, nWorkers = createPool(nWorkers) </code></pre><p>After initializing the workers, the packages must be loaded on each worker:</p><pre><code class="language-julia">@everywhere using COBRA
@everywhere using MATLAB</code></pre><h3><a class="nav-anchor" id="Sharing-the-load-1" href="#Sharing-the-load-1">Sharing the load</a></h3><p>Within <code>PALM.jl</code>, the load is shared automatically. However, it might be illustrative to check upfront when planning a large-scale simulation how the load will be shared. For this purpose, the <code>shareLoad</code> function within the <code>COBRA.jl</code> package may be used.</p><p>If there are 4 models to be distributed across 4 workers, the load sharing is ideal, as every worker will run 1 model.</p><pre><code class="language-julia">nWorkers, quotientModels, remainderModels = COBRA.shareLoad(4)</code></pre><p>In case of sharing 6 models across the connected 4 workers, the load sharing will not be ideal:</p><pre><code class="language-julia">nWorkers, quotientModels, remainderModels = COBRA.shareLoad(6)</code></pre><h3><a class="nav-anchor" id="Preparing-the-models-1" href="#Preparing-the-models-1">Preparing the models</a></h3><p>In order to illustrate how several models can be loaded, the models included in the COBRA Toolbox may be used. The list of models may be displayed using:</p><pre><code class="language-julia">modelDir = &quot;$installDir/test/models/mat&quot;
readdir(modelDir)</code></pre><h3><a class="nav-anchor" id="Output-variables-1" href="#Output-variables-1">Output variables</a></h3><p>The variables that should be retrieved from the script (see <code>scriptFile.m</code>) can be defined in an array as follows:</p><pre><code class="language-julia">varsCharact = [&quot;nMets&quot;, &quot;nRxns&quot;, &quot;nElem&quot;, &quot;nNz&quot;]</code></pre><p><strong>Note:</strong> The variable names defined in <code>varsCharac</code> are the same as in the MATLAB script.</p><h3><a class="nav-anchor" id="Running-PALM-1" href="#Running-PALM-1">Running PALM</a></h3><p>The input parameters of <code>PALM.jl</code> are defined as:</p><pre><code class="language-julia">? PALM</code></pre><p>Now, all variables are defined, and <code>PALM.jl</code> is ready to be launched:</p><pre><code class="language-julia">PALM(modelDir, &quot;$(Pkg.dir(&quot;COBRA&quot;))/test/scriptFile.m&quot;, nWorkers, &quot;modelCharacteristics.mat&quot;, varsCharact, installDir)</code></pre><p>The output file that contains the values of the variables defined in <code>varsCharact</code> for each model is <code>modelCharacteristics.mat</code>. This file can be read back into Julia by using:</p><pre><code class="language-julia">using MAT
vars = matread(&quot;modelCharacteristics.mat&quot;)</code></pre><p>The full data set can be retrieved with: </p><pre><code class="language-julia">summaryData = vars[&quot;summaryData&quot;]</code></pre><footer><hr/><a class="previous" href="beginnerGuide.html"><span class="direction">Previous</span><span class="title">Beginner&#39;s Guide</span></a><a class="next" href="configuration.html"><span class="direction">Next</span><span class="title">Configuration</span></a></footer></article></body></html>
